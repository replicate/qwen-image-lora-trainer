build:
  # Base image with CUDA support
  gpu: true
  cuda: "12.6"
  python_version: "3.10"
  
  # System packages (minimal for Ubuntu 24.04 base)
  system_packages:
    - "libgl1-mesa-dri"
    - "libxrender1"
    - "libgomp1"
    - "git"
    - "git-lfs"
    - "libglib2.0-0"
    - "libsm6"
    - "libxext6"
  
  # Install all dependencies including torch from requirements.txt
  python_requirements: "requirements.txt"
  
  # Caching environment variables for faster model downloads
  run:
    - "export HF_HUB_ENABLE_HF_TRANSFER=1"
    - "export HF_HOME=/root/.cache/hf"
    - "export TRANSFORMERS_CACHE=/root/.cache/hf/transformers"
    - "export TORCH_HOME=/root/.cache/torch"

# Specify the training and prediction entry points
train: "train.py:train"
predict: "predict.py:Predictor"

# Optional: specify image for faster builds (if you have a pre-built base image)
# image: "your-registry/qwen-image-base:latest"